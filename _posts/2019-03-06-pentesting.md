---
layout: post
title: Pentesting
subtitle: A list of useful references and commands for pentesting
---

This post contains some personal thoughts and experiences as well as tools and commands that I find useful.

# A Few Thoughts

Most of my pentesting experience comes from [Offsec's PWK course](https://www.offensive-security.com/information-security-certifications/oscp-offensive-security-certified-professional/), so take the following thoughts as _opinions_ formed by that experience. I don't know everything, but I hope my thoughts and these resources can be of help to you.

## Mindset

I'm convinced that the most important skills to be successful at pentesting are **determination** and **persistence**. Having the will to press forward and try new things after 5 hours of struggle is a _rare_ and _valuable_ skill. Hence the Offensive Security motto "Try Harder." 

Sure. You need to understand basic hacking stuff, but those are easier skills to develop than _the will to press on_. When beginning to learn about pentesting, just understand that you're going to make mistakes that will waste hours of you time. Just accept that reality, and don't let it get you down. Everyone who is ahead of you has been there before, _trust me_.

Most things in exploitation are very tedious, so it's really easy to miss something small that will screw you up for hours. The key is having the motivation to keep trying.

## Understanding What's Happening

**Script Kitties.** Everybody was one at some point. The thing is, you should try to dig in and gain deeper understanding of _how_ systems work, _how_ certain tools work, _how_ particular protocols work and _how_ they've been exploited in the past. Don't just download a script off of Exploit-DB and fire away. Sure, it may work, but did you actually learn anything after landing a shell someone else's code got for you? Learn some basic coding conventions if you don't already know how to program, and try to understand what an exploit actually does.  

## Process 

### Keeping Notes

Being methodical in your process can go a long way. You can race through your enumeration and easily miss an open port or a configuration error that allows you access. Take notes of everything you do. I recommend something like [Keepnote](http://keepnote.org/manual/images/screenshot1.png). It makes it really easy to organize notes. While I'm working through a network, my keepnote format will look something like this:

```
/ 192.168.0.0                          Key:
	. Nmap_scan_192.168.0.1-254    / folder
	. dns_zone_transfer            . file
	/ 192.168.0.1
		. initial_nmap_scan
		. wpscan.txt
		. low_priv_shell_howto.txt
		. TODO
		/ artifacts
			. proof.txt
	/ 192.168.0.2
		. etc...
```

Keeping notes of everything makes it a little easier to catch things that you accidentally miss. It also makes write-ups go much faster.

### Circling Back / Rabbit Trails

Don't be afraid to go back to the beginning and reevaluate the whole problem again. I do it a lot actually. Getting into a box requires you to try things, namely *everything*. So do that. Follow the rabbit trail as far as you think it'll go, but _don't get stuck by forgetting about the other options you had to start with_. Some rabbit trails seem really appealing, especially if you are _convinced_ you are 1 second away from a shell. If you've been on that edge for like an hour... you're probably not actually on that edge, and should reevaluate. 

Over time, you develop a sense for what's the legitimate vulnerability and it happens _less_. Until then, just try everything, but don't get stuck down one single rabbit trail. 

# Tools and Snippets

The rest of the post is a compilation of resources for you and me. These are tools that I used during PWK, but the list is by no means exhaustive. Use this as a reference as you wish, but I strongly encourage you to find other resources to reference. Check out the very bottom of the post for a list of other people's resources that I've found useful. 

# Information Gathering

## Ping

Ping sweeps are a pretty easy way to see what's on your subnet. This assumes a /24 network, but you could scan bigger or smaller if needed.

```bash
for i in {1..254}; do ping -c 1 -W 1 192.168.0.$i; done
```

## Nmap

- Most useful Nmap option:

```bash
nmap -h | grep <anything>
```

Sorry for that one... But seriously, the help output on Nmap is very useful, but VERY verbose. Most of the time, your `nmap` commands are going to be pretty intense, so knowing how to find different options is necessary for this tool.

- Example Usage:

```bash
# Verbose Output, Service/Version info, SYN Scan, T<0-5> faster execution
nmap -v -sV -sS -T4 <target>
```

- Specifying Ports:

```bash
# You can specify what most-used ports you want to scan
nmap --top-ports=20 <target>
# You can also specify ALL ports
nmap -p- <target>
# A list
nmap -p 21,80,443,31337 <target>
```

- Script Scans (FTP example):
	- Scripts located in at: `/usr/share/nmap/scripts/` or just run `locate *.nse`

```bash
# You can use 
locate *ftp*.nse # Or use find if that's your thing
nmap -p 21 --script=<script> <target>
nmap -p 21 --script=ftp-* <target>
```

- Other Useful Options:

```bash
# Aggressive (enables OS detection, version detection, script scanning, and traceroute...) Pretty beefy, so probably use -v or apt-get some patience, because it'll probably take awhile
nmap -v -A <target>
# OS Detection
nmap -v -O <target>
# Default Script Scan
nmap -v -sC <target>
```

- Using Nmap over Proxychains:
	- So Proxychains is used to encapsulate TCP network traffic over a tunnel, so other protocols won't work (like ICMP with ping sweeps). Use the following syntax if you're running a scan over an SSH tunnel while pivoting through a network:

```bash
proxychains nmap -Pn -sT <target>
```

## Unicornscan

- Unicorn scan is a little faster at simply finding open ports sometimes:

```bash
unicornscan -p -a <target>
```

## Masscan

Exceptionally faster than `nmap` and `unicornscan`.

```bash
# Scan a range of ports over many hosts
masscan -p80,8000-8100 10.0.0.0/8
```

## Bscan

Go check out [bscan](https://github.com/welchbj/bscan). It runs a few well-known scanning tools that are native to Kali Linux and logically organizes the tool outputs into a directory and file structure based on the host and type of scan. Here's a basic syntax:

```bash
bscan --verbose-status --max-concurrency 5 <IP/target>
```

## HTTP Scanning

- `dirb` is a web directory brute forcer. Very useful for finding directories to probe on web apps

```bash
dirb <target>
```

- `nikto` scans for vulnerabilities and other helpful information

```bash
nikto -h <target> -p <port>
```

- `cewl` is a web scraper that makes wordlists for you. Pretty useful for conducting intellegent dictionary attacks

```bash
cewl -w <outputfile> <target>
```

- `wpscan` scans WordPress sites

```bash
# Looks for plugins
wpscan --url <target> --enumerate -p
```

### SMB/SAMBA

- `enum4linux` is a tool that will do some enumeration for you:

```bash
enum4linux -a <target>
```

- Or use `nmap`:

```bash
nmap -p 135,139,445 --script=smb* <target>
```

### FTP

- Go for the easy peasy `anonymous` login. If not, do some nmap scanning with this:

```bash
nmap -p 21 -v --script=ftp* <target>
```

- Or just do a banner grab to try to get the version to lookup exploits for:

```bash
nc -nv <target> 21
```

### DNS

DNS is a big one, especially when you first get onto a target network. If not properly configured, you can gain a lot of information really quick from DNS.

- `host`

```bash
# Host can do forward and reverse lookups
host -t ns <url>
host -t mx <url>
host -l <domain> <dns server>

# A utility to interact with dns servers
nslookup
	> set type=any
	> server <dns server>
	> ls -d <target>

# Zone Transfer with dig
dig axfr <domain> @<name server>

# Will lookup a domain name with any local dns servers
whois <domain>

# Recon Tools
dnsrecon -d <domain> -t axfr

dnsenum <domain>
```

### SNMP

```bash
onesixtyone <target>
```

### NFS / RPC

- Manual enumeration

```bash
showmount -e <target>
```

- `nmap`

```bash
nmap -v --script=nfs* <target>
```

- `rpcinfo` provides a list of programs for us

```bash
rpcinfo -p <target>
```

- `rpcclinet` to interact manually

```bash
rpcclient -U '' <target>
```

# Identifying Vulnerabilities

- <https://google.com>. Seriously, just google **everything**.
	- Use "quotes" around technical terms regarding the vulnerability to ensure that text is actually in the web content that Google brings up for you.

- <https://exploit-db.com>. You can go to the Exploit DB website (usually through a link on Google after searching for a vulnerable app)

- Or you can use the Kali local version called `searchsploit`

```bash
# You can also pipe this output to grep to search more precisely 
searchsploit <description/version numbers>
```

# Initial Access

## Brute Forcing

- `nmap`
- `john`
- `hydra`
- `medusa` is a web

## Web Apps

- `burpsuite`

### LFI / RFI

### Reverse Shells

Method:
1. Use your limited RCE to enumerate the scripting languages you can leverage.
2. Try shells from the following that match what is available on the target.

- perl
- bash
- netcat
- kali webshells
- ruby
- php

## Generating Payloads

- `msfvenom`

# Privilege Escalation

## Linux
- gotm1lk blog

## Windows
- windows priv esc blog

### Compiling Windows Exploits on Windows

# Pivoting

## SSH Tunnels

### Local Port Forwarding

### Remote Port Forwarding

### Dynamic Port Forwarding

# Useful Command Line Utilities

## File Searches

- `find`
- `grep`

## User Permissions

## Firewall Rules

- Linux
- Windows

## File Sharing

## File Formatting Issues

- `dos2unix`

# Other Resources
- <https://highon.coffee/blog/penetration-testing-tools-cheat-sheet/>
- <https://pages.brianwel.ch/hacks>
- <https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/>
- <http://www.fuzzysecurity.com/tutorials/16.html>